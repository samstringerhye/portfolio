---
import experience from '../content/experience.json'

const jobs = experience.jobs
const HeadingTag = experience.headingTag as any
const JobTag = experience.jobTitleTag as any
const CompanyTag = experience.companyTag as any

function formatDate(dateStr: string | null) {
  if (!dateStr) return 'Present'
  const [year, month] = dateStr.split('-')
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
  return `${months[parseInt(month) - 1]} ${year}`
}
---

<section class="timeline-section" aria-label="Experience">
  <div class="timeline-inner">
    <HeadingTag class={`typo-${experience.headingRole}`} data-reveal>Experience</HeadingTag>
    <ol class="timeline" role="list">
      {jobs.map((job, i) => (
        <li class="timeline-item" data-reveal="stagger">
          <div class="timeline-dot" aria-hidden="true" />
          {i < jobs.length - 1 && <div class="timeline-line" aria-hidden="true" />}
          <div class="timeline-content">
            <JobTag class:list={["timeline-title", `typo-${experience.jobTitleRole}`]}>{job.title}</JobTag>
            <CompanyTag class:list={["timeline-company", `typo-${experience.companyRole}`]}>
              {job.company} &middot; {job.startDate
                ? <time datetime={job.startDate}>{formatDate(job.startDate)}</time>
                : formatDate(job.startDate)} — {job.endDate
                ? <time datetime={job.endDate}>{formatDate(job.endDate)}</time>
                : formatDate(job.endDate)}
            </CompanyTag>
            {job.highlights && job.highlights.length > 0 && (
              <ul class:list={["timeline-highlights", `typo-${experience.highlightRole}`]} role="list">
                {job.highlights.map(h => <li>{h}</li>)}
              </ul>
            )}
          </div>
        </li>
      ))}
    </ol>
  </div>
</section>

<style>
  .timeline-section {
    padding-block: var(--section-padding);
  }

  .timeline-inner {
    max-width: var(--container-content);
    margin: 0 auto;
    padding-inline: var(--page-padding);
  }

  .timeline-inner > h2 {
    margin-bottom: var(--space-4);
  }

  .timeline {
    position: relative;
  }

  .timeline-item {
    position: relative;
    padding-left: var(--space-6);
    padding-bottom: var(--space-6);
  }

  .timeline-item:last-child {
    padding-bottom: 0;
  }

  .timeline-dot {
    position: absolute;
    left: 0;
    top: 6px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--color-text-secondary);
  }

  .timeline-line {
    position: absolute;
    left: 3.5px;
    top: 18px;
    bottom: 0;
    width: 1px;
    background: var(--color-border);
  }

  .timeline-title {
    margin-bottom: 2px;
  }

  .timeline-company {
    color: var(--color-text-secondary);
  }

  .timeline-highlights {
    margin-top: var(--space-2);
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    list-style: none;
  }

  .timeline-highlights li {
    position: relative;
    padding-left: var(--space-3);
    color: var(--color-text-secondary);
  }

  .timeline-highlights li::before {
    content: '—';
    position: absolute;
    left: 0;
    color: var(--color-border);
  }
</style>
