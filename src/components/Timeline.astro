---
import experience from '../data/experience.json'
import typo from '../data/typography.json'

const thCfg = typo.tags.timelineHeading
const tjCfg = typo.tags.timelineJobTitle
const HeadingTag = thCfg.tag as any
const JobTag = tjCfg.tag as any

function formatDate(dateStr: string | null) {
  if (!dateStr) return 'Present'
  const [year, month] = dateStr.split('-')
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
  return `${months[parseInt(month) - 1]} ${year}`
}
---

<section class="timeline-section" aria-label="Experience">
  <div class="timeline-inner">
    <HeadingTag class={`typo-${thCfg.role}`}>Experience</HeadingTag>
    <ol class="timeline" role="list">
      {experience.map((job, i) => (
        <li class="timeline-item" data-reveal="stagger">
          <div class="timeline-dot" aria-hidden="true" />
          {i < experience.length - 1 && <div class="timeline-line" aria-hidden="true" />}
          <div class="timeline-content">
            <JobTag class:list={["timeline-title", `typo-${tjCfg.role}`]}>{job.title}</JobTag>
            <p class="timeline-company">
              {job.company} &middot; {job.startDate
                ? <time datetime={job.startDate}>{formatDate(job.startDate)}</time>
                : formatDate(job.startDate)} â€” {job.endDate
                ? <time datetime={job.endDate}>{formatDate(job.endDate)}</time>
                : formatDate(job.endDate)}
            </p>
          </div>
        </li>
      ))}
    </ol>
  </div>
</section>

<style>
  .timeline-section {
    padding: var(--section-padding) var(--page-padding);
  }

  .timeline-inner {
    max-width: var(--container-content);
    margin: 0 auto;
  }

  .timeline-inner > h2 {
    margin-bottom: var(--space-4);
  }

  .timeline {
    position: relative;
  }

  .timeline-item {
    position: relative;
    padding-left: var(--space-6);
    padding-bottom: var(--space-6);
  }

  .timeline-item:last-child {
    padding-bottom: 0;
  }

  .timeline-dot {
    position: absolute;
    left: 0;
    top: 6px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--color-text-secondary);
  }

  .timeline-line {
    position: absolute;
    left: 3.5px;
    top: 18px;
    bottom: 0;
    width: 1px;
    background: var(--color-border);
  }

  .timeline-title {
    margin-bottom: 2px;
  }

  .timeline-company {
    color: var(--color-text-secondary);
  }
</style>
