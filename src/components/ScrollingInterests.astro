---
interface Props {
  interests: string[]
}

const { interests } = Astro.props
const text = interests.join(' \u00b7 ') + ' \u00b7 '
const copies = 4
---

<section class="interests-section" aria-label="Interests">
  <div class="interests-row" data-direction="left">
    <svg class="interests-svg-defs" aria-hidden="true">
      <defs>
        <filter id="distort-1" color-interpolation-filters="sRGB" x="-20%" y="-20%" width="140%" height="140%">
          <feTurbulence type="turbulence" baseFrequency="0.012" numOctaves="3" seed="42" result="noise" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="0" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>
    <div class="interests-track">
      {Array.from({ length: copies }, () => (
        <span class="interests-text">{text}</span>
      ))}
    </div>
  </div>

  <div class="interests-row" data-direction="right">
    <svg class="interests-svg-defs" aria-hidden="true">
      <defs>
        <filter id="distort-2" color-interpolation-filters="sRGB" x="-20%" y="-20%" width="140%" height="140%">
          <feTurbulence type="turbulence" baseFrequency="0.012" numOctaves="3" seed="99" result="noise" />
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="0" xChannelSelector="R" yChannelSelector="G" />
        </filter>
      </defs>
    </svg>
    <div class="interests-track">
      {Array.from({ length: copies }, () => (
        <span class="interests-text">{text}</span>
      ))}
    </div>
  </div>
</section>

<style>
  .interests-section {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: var(--space-lg);
    overflow: hidden;
  }

  .interests-row {
    position: relative;
    overflow: hidden;
    cursor: default;
  }

  .interests-svg-defs {
    position: absolute;
    width: 0;
    height: 0;
    pointer-events: none;
  }

  .interests-track {
    display: flex;
    white-space: nowrap;
    will-change: transform;
  }

  .interests-text {
    font-size: clamp(var(--font-size-5xl), 6vw, var(--font-size-7xl));
    font-weight: var(--font-weight-regular);
    color: var(--color-text-primary);
    line-height: 1.2;
    padding: 0 0.1em;
  }
</style>

<script>
  import gsap from 'gsap'

  function initScrollingInterests() {
    const rows = document.querySelectorAll('.interests-row')

    rows.forEach((row, i) => {
      const track = row.querySelector('.interests-track')
      if (!track) return

      const copyWidth = (track as HTMLElement).scrollWidth / 4
      const direction = row.getAttribute('data-direction')
      const filterId = `distort-${i + 1}`

      ;(track as HTMLElement).style.filter = `url(#${filterId})`

      if (direction === 'left') {
        gsap.to(track, {
          x: -copyWidth,
          duration: 30,
          ease: 'none',
          repeat: -1,
          modifiers: {
            x: gsap.utils.unitize((x: string) => parseFloat(x) % copyWidth),
          },
        })
      } else {
        gsap.set(track, { x: -copyWidth })
        gsap.to(track, {
          x: 0,
          duration: 30,
          ease: 'none',
          repeat: -1,
          modifiers: {
            x: gsap.utils.unitize((x: string) => {
              const v = parseFloat(x) % copyWidth
              return v === 0 ? 0 : v - copyWidth
            }),
          },
        })
      }
    })
  }

  initScrollingInterests()
  document.addEventListener('astro:page-load', initScrollingInterests)
</script>
