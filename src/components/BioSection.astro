---
interface Props {
  bio: string
  aboutCTA: string
}

const { bio, aboutCTA } = Astro.props
---

<section class="bio-section">
  <div class="bio-inner">
    <p class="bio-text" data-bio-text>{bio}</p>
  </div>
</section>

<style>
  .bio-section {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: var(--space-4xl) var(--space-xl);
  }

  .bio-inner {
    width: 100%;
    max-width: var(--max-width);
    margin: 0 auto;
  }

  .bio-text {
    font-size: clamp(var(--font-size-xl), 3vw, var(--font-size-3xl));
    line-height: var(--line-height-relaxed);
    color: var(--color-text-primary);
    max-width: 60ch;
  }

  .bio-text :global(.bio-line) {
    display: block;
    opacity: 0;
    transform: translateY(30px);
    filter: blur(14px);
  }
</style>

<script>
  import { gsap, ScrollTrigger, prefersReducedMotion, chromaticShadow, SHADOW_CLEAR } from '../utils/animation'
  import { splitIntoLines } from '../utils/split-into-lines'

  let bioTrigger: globalThis.ScrollTrigger | null = null

  function animateBioLines() {
    const el = document.querySelector<HTMLElement>('[data-bio-text]')
    if (!el) return

    // Kill previous trigger to avoid duplicates on re-navigation
    if (bioTrigger) {
      bioTrigger.kill()
      bioTrigger = null
    }

    if (!el.dataset.originalText) {
      el.dataset.originalText = el.textContent || ''
    } else {
      el.textContent = el.dataset.originalText
    }

    const lines = splitIntoLines(el, 'bio-line')

    if (prefersReducedMotion()) {
      gsap.set(lines, { opacity: 1, y: 0, filter: 'blur(0px)', textShadow: 'none' })
      return
    }

    const shadowFrom = chromaticShadow(30, 0.5)

    gsap.set(lines, {
      opacity: 0, y: 30, filter: 'blur(14px)', textShadow: shadowFrom,
    })

    bioTrigger = ScrollTrigger.create({
      trigger: el,
      start: 'top 60%',
      once: true,
      onEnter: () => {
        gsap.to(lines, {
          opacity: 1, y: 0, filter: 'blur(0px)', textShadow: SHADOW_CLEAR,
          duration: 1.2, stagger: 0.12, ease: 'power3.out',
        })
      },
    })
  }

  document.addEventListener('astro:page-load', animateBioLines)
</script>
